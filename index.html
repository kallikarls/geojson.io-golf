<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <link href='bundle.css' rel='stylesheet' />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700;800&display=swap" rel="stylesheet" />

  <title>geojson.io | powered by Mapbox</title>

  <link rel="icon" type="image/x-icon" href="./img/favicon.png" />
  <meta name="author" content="Mapbox" />
  <meta name="description" content="A quick, simple tool for creating, viewing, and sharing spatial data." />
  <meta property="og:site_name" content="geojson.io" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@mapbox" />
  <meta name="twitter:creator" content="@mapbox" />
  <meta property="og:url" content="https://geojson.io" />
  <meta property="og:title" content="geojson.io | powered by Mapbox" />
  <meta property="og:description" content="A quick, simple tool for creating, viewing, and sharing spatial data." />
  <meta property="og:image" content="/img/twitter-card-image.png" />

  <meta http-equiv="Content-Security-Policy" content="
    default-src
      'self'
      ;
    child-src
      'self'
      blob:
      ;
    connect-src
      'self'
      *
      ;
    font-src
      https://fonts.gstatic.com/
      'self'
      ;
    frame-src
      'self'
      ;
    img-src
      'self'
      data:
      *
      ;
    script-src
      'self'
      'unsafe-eval'
      'unsafe-inline'
      https://cdn.segment.com
      https://assets.customer.io
      https://secure.gaug.es
      https://www.google-analytics.com
      https://www.googletagmanager.com/gtag/js
      https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js
      https://docs.mapbox.com
      ;
    style-src
      'self'
      'unsafe-inline'
      ;
  ">
  <!-- Add segment tracking for tool usage -->
  <script src="https://docs.mapbox.com/analytics.min.js"></script>

  <!-- G4A Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3K6EEFGNP0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-3K6EEFGNP0');
  </script>

<style>
  /* framebust guard */
  body { display: none; }

  /* Desktop/large only: show the file-bar */
  @media (min-width: 901px) {
    .file-bar { display: flex !important; }
  }

  /* MOBILE / PDA */
  @media (max-width: 900px) {

    /* Move the geojson.io title to the right so it doesn't sit behind the hamburger */
    .topbar .branding,
    .topbar h1,
    .topbar .site-title,
    header .branding,
    header h1,
    header .site-title {
      margin-left: 44px !important;  /* same space as the hamburger + gap */
      display: inline-block;
    }

    /* Hide layer + projection switches */
    .layer-switch, .projection-switch { display: none !important; }

    /* Optional: hide bottom-left wrapper */
    .mapboxgl-ctrl-bottom-left { display: none !important; }

    /* Hide the editor sidebar (your actual class combo) */
    .right.flex.flex-col.bg-white.relative,
    [class~="right"][class~="flex-col"][class~="bg-white"][class~="relative"] {
      display: none !important;
      width: 0 !important; height: 0 !important;
      max-width: 0 !important; max-height: 0 !important;
      padding: 0 !important; margin: 0 !important;
      overflow: hidden !important;
    }

    /* Fill screen with the map; neutralize basis-0 */
    .map {
      display: block !important;
      flex: 1 1 auto !important;
      flex-basis: 100% !important;
      width: 100% !important; max-width: 100% !important;
      height: 100vh !important;
    }
    .map.basis-0 { flex-basis: 100% !important; }

    /* Fullscreen page, no scrollbars */
    html, body { height: 100%; overflow: hidden; margin: 0; }

    /* KEEP the top bar visible on mobile and reserve space for burger */
    .topbar, header {
      position: relative !important;
      padding-left: 44px !important;   /* 36px button + 8px gap */
      z-index: 10005;
    }

    /* Hide original file-bar on mobile (menu replaces it) */
    .topbar .file-bar, header .file-bar, .file-bar {
      display: none !important;
    }

    /* Search (Mapbox geocoder / custom) — hide on mobile */
    .mapboxgl-ctrl-geocoder, #search, .search, input[type="search"] {
      display: none !important;
    }

    /* Reserve space for the hamburger inside the actual header row */
    .geojsonio .text-white.bg-mb-gray-dark.font-sans.px-3.flex,
    .geojsonio .px-3.flex {
      padding-left: 44px !important; /* 36px button + 8px gap */
    }

    /* Hamburger button (inside top bar) */
    .mobile-menu-btn {
      position: absolute !important;
      top: 6px !important; left: 6px !important;
      z-index: 10010 !important;
      display: flex; align-items: center; justify-content: center;
      width: 36px; height: 36px;
      color: #000 !important;      /* black icon/text */
      border: none; border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,.15);
      font-size: 20px; line-height: 1; cursor: pointer;
    }

    /* Mobile dropdown styling fix */
    .mobile-menu {
      position: absolute !important;
      top: 44px !important;
      left: 6px !important;
      z-index: 10010 !important;

      /* visual */
      background: #fff !important;        /* white background */
      color: #000 !important;             /* black text */
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.18);
      padding: 6px;
      min-width: 160px;
      display: none;
      font-family: system-ui, sans-serif;
    }

    .mobile-menu.open { display: block; }

    .mobile-menu button {
      width: 100%; padding: 10px 12px; text-align: left;
      background: transparent; border: none; border-radius: 8px;
      color: #000 !important;             /* ensure readable text */
      font-size: 14px; cursor: pointer;
    }
    .mobile-menu button:hover { background: rgba(0,0,0,.06); }
  }

  /* Big floating action buttons for PDA */
  .geo-fab {
    position: absolute;
    right: 12px;
    z-index: 10020;
    width: 56px; height: 56px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; line-height: 1.1; text-align: center;
    background: #fff;
    box-shadow: 0 6px 18px rgba(0,0,0,.22);
    border: none;
    cursor: pointer;
    user-select: none;
  }
  .geo-fab:active { transform: scale(0.98); }

  /* Stack the two FABs */
  #fab-sprinkler { bottom: 84px; }  /* on top */
  #fab-pump      { bottom: 16px; }  /* below */

  /* Label styling inside the circle */
  .geo-fab span {
    color: #000;
    padding: 0 6px;
  }

  /* Optional: subtle success toast */
  .geo-toast {
    position: absolute; left: 50%; bottom: 150px; transform: translateX(-50%);
    background: rgba(0,0,0,.85); color: #fff; padding: 8px 12px; border-radius: 8px;
    font-size: 13px; z-index: 10030; display: none;
  }
  .geo-toast.show { display: inline-block; }
</style>


</head>

<body id="geojsonio-body" class="h-full">
  <div class="geojsonio flex flex-col h-full">
    <div class="text-white bg-mb-gray-dark font-sans px-3 flex">
      <div class="font-extrabold flex items-center tracking-wide text-base">        geojson.io
      </div>
      <div class="flex-grow flex justify-end">
        <div style="height: 42px"></div>
        <div class="flex items-center bg-pink" style="font-size: 10px">
          powered by
          <div class="pr-3">
            <div class="bg-no-repeat bg-center ml-2" style="
                  height: 18px;
                  width: 76px;
                  background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTAgMTgwIj48cGF0aCBkPSJNODkuMSAxLjhDMzkuOSAxLjggMCA0MS43IDAgOTAuOSAwIDE0MC4xIDM5LjkgMTgwIDg5LjEgMTgwYzQ5LjIgMCA4OS4xLTM5LjkgODkuMS04OS4xIDAtNDkuMi0zOS45LTg5LjEtODkuMS04OS4xem00NTcuOCAxOS43Yy0xLjIgMC0yLjIgMS0yLjIgMi4ydjEwMy4yYzAgMS4yIDEgMi4yIDIuMiAyLjJoMTMuNGMxLjIgMCAyLjItMSAyLjItMi4ydi03LjFjNi45IDcuMiAxNi40IDExLjMgMjYuMyAxMS4zIDIwLjkgMCAzNy45LTE4IDM3LjktNDAuMyAwLTIyLjMtMTctNDAuMi0zNy45LTQwLjItMTAgMC0xOS41IDQuMS0yNi4zIDExLjNWMjMuN2MwLTEuMi0xLTIuMi0yLjItMi4yaC0xMy40ek05OC4zIDM2LjRjMTEuNC4zIDIyLjkgNC44IDMxLjcgMTMuNyAxNy43IDE3LjcgMTguMyA0NS43IDEuNCA2Mi43LTMwLjUgMzAuNS04NC44IDIwLjctODQuOCAyMC43cy05LjgtNTQuMyAyMC43LTg0LjhjOC41LTguNCAxOS43LTEyLjUgMzEtMTIuM3ptMTYwLjMgMTQuMmMtOC4yIDAtMTUuOSA0LTIwLjggMTAuNnYtNi40YzAtMS4yLTEtMi4yLTIuMi0yLjJoLTEzLjRjLTEuMiAwLTIuMiAxLTIuMiAyLjJWMTI3YzAgMS4yIDEgMi4yIDIuMiAyLjJoMTMuNGMxLjIgMCAyLjItMSAyLjItMi4yVjgzLjhjLjUtOS43IDcuMi0xNy4zIDE1LjQtMTcuMyA4LjUgMCAxNS42IDcuMSAxNS42IDE2LjV2NDRjMCAxLjIgMSAyLjIgMi4yIDIuMmgxMy41YzEuMiAwIDIuMi0xIDIuMi0yLjJsLS4xLTQ0LjljMS4yLTguOCA3LjYtMTUuNiAxNS4zLTE1LjYgOC41IDAgMTUuNiA3LjEgMTUuNiAxNi41djQ0YzAgMS4yIDEgMi4yIDIuMiAyLjJoMTMuNWMxLjIgMCAyLjItMSAyLjItMi4ybC0uMS00OS42Yy4zLTE0LjgtMTIuMy0yNi44LTI3LjktMjYuOC0xMCAuMS0xOS4yIDUuOS0yMy41IDE1LTUtOS4zLTE0LjctMTUuMS0yNS4zLTE1em0xMjcuOSAwYy0yMC45IDAtMzcuOSAxOC0zNy45IDQwLjMgMCAyMi4zIDE3IDQwLjMgMzcuOSA0MC4zIDEwIDAgMTkuNS00LjEgMjYuMy0xMS4zdjcuMWMwIDEuMiAxIDIuMiAyLjIgMi4yaDEzLjRjMS4yIDAgMi4yLTEgMi4yLTIuMlY1NC44Yy4xLTEuMi0uOS0yLjItMi4yLTIuMkg0MTVjLTEuMiAwLTIuMiAxLTIuMiAyLjJ2Ny4xYy02LjktNy4yLTE2LjQtMTEuMy0yNi4zLTExLjN6bTEwNi4xIDBjLTEwIDAtMTkuNSA0LjEtMjYuMyAxMS4zdi03LjFjMC0xLjItMS0yLjItMi4yLTIuMmgtMTMuNGMtMS4yIDAtMi4yIDEtMi4yIDIuMlYxNThjMCAxLjIgMSAyLjIgMi4yIDIuMmgxMy40YzEuMiAwIDIuMi0xIDIuMi0yLjJ2LTM4LjJjNi45IDcuMiAxNi40IDExLjMgMjYuMyAxMS4zIDIwLjkgMCAzNy45LTE4IDM3LjktNDAuMyAwLTIyLjMtMTctNDAuMi0zNy45LTQwLjJ6bTE4NS41IDBjLTIyLjcgMC00MSAxOC00MSA0MC4zIDAgMjIuMyAxOC40IDQwLjMgNDEgNDAuM3M0MS0xOCA0MS00MC4zYzAtMjIuMy0xOC4zLTQwLjMtNDEtNDAuM3ptNDUuNCAyYy0xLjEgMC0yIC45LTIgMiAwIC40LjEuOC4zIDEuMWwyMyAzNS0yMy4zIDM1LjRjLS42LjktLjQgMi4yLjYgMi44LjMuMi43LjMgMS4xLjNoMTUuNWMxLjIgMCAyLjMtLjYgMi45LTEuNmwxMy44LTIzLjEgMTMuOCAyMy4xYy42IDEgMS43IDEuNiAyLjkgMS42aDE1LjVjMS4xIDAgMi0uOSAyLTIgMC0uNC0uMS0uNy0uMy0xLjFMNzY2IDkwLjdsMjMtMzVjLjYtLjkuNC0yLjItLjYtMi44LS4zLS4yLS43LS4zLTEuMS0uM2gtMTUuNWMtMS4yIDAtMi4zLjYtMi45IDEuNmwtMTMuNSAyMi43LTEzLjUtMjIuN2MtLjYtMS0xLjctMS42LTIuOS0xLjZoLTE1LjV6TTk5LjMgNTRsLTguNyAxOC0xNy45IDguNyAxNy45IDguNyA4LjcgMTggOC44LTE4IDE3LjktOC43LTE3LjktOC43LTguOC0xOHptMjkwLjMgMTIuN2MxMi43IDAgMjMgMTAuNyAyMy4yIDIzLjl2LjZjLS4xIDEzLjItMTAuNSAyMy45LTIzLjIgMjMuOS0xMi44IDAtMjMuMi0xMC44LTIzLjItMjQuMiAwLTEzLjQgMTAuNC0yNC4yIDIzLjItMjQuMnptOTkuOCAwYzEyLjggMCAyMy4yIDEwLjggMjMuMiAyNC4yIDAgMTMuNC0xMC40IDI0LjItMjMuMiAyNC4yLTEyLjcgMC0yMy0xMC43LTIzLjItMjMuOXYtLjZjLjItMTMuMiAxMC41LTIzLjkgMjMuMi0yMy45em05Ni4zIDBjMTIuOCAwIDIzLjIgMTAuOCAyMy4yIDI0LjIgMCAxMy40LTEwLjQgMjQuMi0yMy4yIDI0LjItMTIuNyAwLTIzLTEwLjctMjMuMi0yMy45di0uNmMuMi0xMy4yIDEwLjUtMjMuOSAyMy4yLTIzLjl6bTkyLjIgMGMxMi44IDAgMjMuMiAxMC44IDIzLjIgMjQuMiAwIDEzLjQtMTAuNCAyNC4yLTIzLjIgMjQuMi0xMi44IDAtMjMuMi0xMC44LTIzLjItMjQuMiAwLTEzLjQgMTAuNC0yNC4yIDIzLjItMjQuMnoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=);
                "></div>
          </div>
          <div class="hidden md:flex pl-3 border-l border-solid border-gray-700 h-full  items-center">
            <a class="bg-mb-purple-500 hover:bg-mb-purple-700 hover:text-white text-white text-xs font-bold py-1 px-4 rounded transition-all duration-200"
              href="https://account.mapbox.com/auth/signup/">
              Sign up for Mapbox
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    if (self == top) {
      document.getElementsByTagName("body")[0].style.display = "block";
    } else {
      top.location = self.location;
    }
  </script>
  <script src="bundle.js"></script>

  <script>
    window.addEventListener('load', function () {
      if (window.innerWidth <= 900) {
        setTimeout(() => {
          if (window.context?.map?.resize) window.context.map.resize();
        }, 200);
      }
    });
  </script>

<script>
(function () {
  const isMobile = window.matchMedia('(max-width: 900px)').matches;

  // Hide the "Meta" button everywhere and hide file-bar on mobile
  function cleanFileBar() {
    document.querySelectorAll('.file-bar').forEach(fb => {
      // Remove "Meta"
      fb.querySelectorAll('a,button,span,div').forEach(el => {
        const t = (el.textContent || '').trim().toLowerCase();
        if (t === 'meta') el.style.display = 'none';
      });
      // Hide the whole bar on mobile (CSS should do it; this enforces it)
      if (isMobile) fb.style.setProperty('display', 'none', 'important');
    });
  }

  // Build hamburger + dropdown and forward to real file-bar buttons
  function buildMobileMenu() {
    if (!isMobile) return;

    const anchor =
      document.querySelector('.geojsonio .text-white.bg-mb-gray-dark.font-sans.px-3.flex') ||
      document.querySelector('.topbar, header') ||
      document.body;

    const btn = document.createElement('button');
    btn.className = 'mobile-menu-btn';
    btn.setAttribute('aria-label', 'Menu');
    btn.textContent = '☰';

    const menu = document.createElement('div');
    menu.className = 'mobile-menu';
    ['Open', 'Save', 'New'].forEach(name => {
      const b = document.createElement('button');
      b.dataset.action = name;
      b.textContent = name;
      menu.appendChild(b);
    });

    btn.addEventListener('click', e => {
      e.stopPropagation();
      menu.classList.toggle('open');
    });
    document.addEventListener('click', () => menu.classList.remove('open'));

    menu.addEventListener('click', e => {
      const b = e.target.closest('button[data-action]');
      if (!b) return;
      const L = b.dataset.action.toLowerCase();
      const real = [...document.querySelectorAll('.file-bar a, .file-bar button')]
        .find(el => (el.textContent || '').trim().toLowerCase() === L);
      if (real) real.click(); else console.warn('file-bar button not found:', L);
      menu.classList.remove('open');
    });

    anchor.appendChild(btn);
    anchor.appendChild(menu);
  }

  // Init after app has built the DOM
  window.addEventListener('load', function () {
    cleanFileBar();
    buildMobileMenu();

    // Ensure the map resizes after our layout changes on mobile
    if (isMobile && window.context?.map?.resize) {
      setTimeout(() => window.context.map.resize(), 200);
    }
  });
})();
</script>

<script>
(function () {
  // ---- CONFIGURE YOUR PROPERTY NAMES HERE ----
  const PUMP_TYPE       = 'irrigation.pump';
  const SPRINKLER_TYPE  = 'irrigation.sprinkler';
  const DEFAULT_LAYER   = 'irrigation'; // optional grouping hint

  // We’ll need a reference to MapboxDraw.
  function getDraw() {
    return window.draw || window.context?.draw || window._draw || null;
  }

  // Tiny toaster for feedback
  function toast(msg, ms = 1200) {
    let t = document.getElementById('geo-toast');
    if (!t) {
      t = document.createElement('div');
      t.id = 'geo-toast';
      t.className = 'geo-toast';
      t.textContent = msg;
      document.body.appendChild(t);
    } else {
      t.textContent = msg;
    }
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), ms);
  }

  // Geolocation helper with good defaults for Android Chrome
  function getCurrentPositionOnce() {
    return new Promise((resolve, reject) => {
      if (!('geolocation' in navigator)) {
        reject(new Error('Geolocation not supported'));
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => resolve(pos),
        err => reject(err),
        {
          enableHighAccuracy: true,    // ask for GPS
          timeout: 10000,              // 10s
          maximumAge: 0
        }
      );
    });
  }

  // Add a point Feature to Draw at [lng, lat] with properties
  function addPointFeature(lng, lat, props) {
    const draw = getDraw();
    if (!draw) throw new Error('MapboxDraw not found (context.draw or window.draw)');
    const feat = {
      type: 'Feature',
      properties: {
        ...props,
        layer: DEFAULT_LAYER,
        source: 'gps',
        createdAt: new Date().toISOString()
      },
      geometry: { type: 'Point', coordinates: [lng, lat] }
    };
    const id = draw.add(feat);
    return Array.isArray(id) ? id[0] : id; // draw.add may return an array
  }

  async function place(typeLabel) {
    try {
      // Guard: secure origin is required (https). GitHub Pages is fine.
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        toast('Needs HTTPS for GPS'); return;
      }

      const pos = await getCurrentPositionOnce();
      const { latitude, longitude, accuracy } = pos.coords;

      if (typeof latitude !== 'number' || typeof longitude !== 'number') {
        toast('Invalid GPS fix'); return;
      }

      // Optional accuracy gate (Android often returns >30m early)
      if (accuracy && accuracy > 60) {
        toast(`Low accuracy (${Math.round(accuracy)}m) — placing anyway`);
      }

      const props = { type: typeLabel };   // your schema: type=irrigation.pump|sprinkler
      const id = addPointFeature(longitude, latitude, props);

      // Subtle feedback
      if (navigator.vibrate) navigator.vibrate(35);
      toast(`${typeLabel.replace('irrigation.', '')} added`);

      // Optional: briefly “ping” the point
      const map = window.context?.map || window.map;
      if (map) {
        map.flyTo({ center: [longitude, latitude], zoom: Math.max(map.getZoom(), 17), speed: 0.9 });
      }
      return id;
    } catch (err) {
      console.warn('GPS add error:', err);
      const code = err && err.code;
      if (code === 1)      toast('Location permission denied');
      else if (code === 2) toast('Position unavailable');
      else if (code === 3) toast('Location timeout');
      else                 toast('Could not get location');
    }
  }

  // Mount two big FAB buttons after app loads
  function mountFabs() {
    // Prevent duplicates
    if (document.getElementById('fab-sprinkler')) return;

    const spr = document.createElement('button');
    spr.id = 'fab-sprinkler';
    spr.className = 'geo-fab';
    spr.title = 'Add sprinkler at GPS';
    spr.innerHTML = '<span>Sprink</span>';
    spr.addEventListener('click', () => place(SPRINKLER_TYPE));

    const pump = document.createElement('button');
    pump.id = 'fab-pump';
    pump.className = 'geo-fab';
    pump.title = 'Add pump at GPS';
    pump.innerHTML = '<span>Pump</span>';
    pump.addEventListener('click', () => place(PUMP_TYPE));

    document.body.appendChild(spr);
    document.body.appendChild(pump);
  }

  // Initialize when everything is ready
  window.addEventListener('load', () => {
    mountFabs();

    // Map resize nudge on mobile after UI settles
    setTimeout(() => {
      if (window.context?.map?.resize) window.context.map.resize();
    }, 250);
  });
})();
</script>


</body>

</html>
